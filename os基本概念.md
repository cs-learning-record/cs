![image](./img/timg.jpg)
<br>

## 前言

在本文将深入展开在面试过程中操作系统部分的知识，用最简短的篇章深入理解。

## 关于作者

一个工作八年的草根程序员。

## 内容

- 概述
- 进程管理
- 死锁
- 内存管理
- 设备管理
- 链接

### 一、概述

- 操作系统基本特征
- 操作系统基本功能
- 系统调用
- 大内核和微内核
- 中断分类
- 什么是堆和栈？说一下堆栈都存储哪些数据？
- 如何理解分布式锁？

#### 1.1 操作系统基本特征

- 并发与并行
- 共享
- 虚拟
- 异步

##### 并发与并行

**并发**是指宏观上在一段时间内能同时运行多个程序，而**并行**则指同一时刻能运行多个指令。

**并行**需要硬件支持，如多流水线或者多处理器。

操作系统通过引入进程和线程，使得程序能够并发运行。

![](./img/os02.png)

##### 共享

共享是指系统中的资源可以被多个并发里程共同使用。

有两种共享方式：互斥共享和同时共享。

**互斥共享**的资源称为临界资源，例如打印机等，在同一时间只允许一个进程访问，需要用同步机制来实现对临界资源的访问。

##### 虚拟

虚拟技术把一个物理实体转换为多个逻辑实体。

利用多道程序设计技术，让每个用户都觉得有一个计算机专门为他服务。

主要有两种虚拟技术：**时分复用技术和空分复用技术**。例如多个进程能在同一个处理器上并发执行使用了时分复用技术，让每个进程轮流占有处理器，每次只执行一小个时间片并快速切换。

##### 异步

异步指进程不是一次性执行完毕，而是走走停停，以不可知的速度向前推进。

但只要运行环境相同，OS需要保证程序运行的结果也要相同。

#### 1.2 操作系统基本功能

- 进程管理
- 内存管理
- 文件管理
- 设备管理

##### 进程管理

进程控制、进程同步、进程通信、死锁处理、处理机调试等。

##### 内存管理

内在分配、地址映射、内在保护与共享、虚拟内存等。

##### 文件管理

文件存储空间的管理、目录管理、文件读写管理和保护等。

##### 设备管理

完成用户的I/O请求，方便用户使用各种设备，并提高设备的利用率。

主要包括缓冲管理、设备分配、设备处理、虚拟设备等。

#### 1.3 系统调用

如果一个进程在**用户态**需要使用**内核态**的功能，就进行系统调用从而陷入内核，由操作系统代为完成。

![](./img/os03.png)

Linux 的系统调用主要有以下这些：

| Task     | Commands                  |
| -------- | ------------------------- |
| 进程控制 | fork();exit();wait();     |
| 进程通信 | pipe();chmget();mmap();   |
| 文件操作 | open();read();write();    |
| 设备操作 | ioctl();read();write();   |
| 信息维护 | getpid();alarm();sleep(); |
| 安全     | chmod();umask();chown();  |


#### 1.4 大内核和微内核

- 大内核
- 微内核

##### 大内核

##### 微内核

#### 1.5 中断分类

#### 1.6 什么是堆和栈？说一下堆栈都存储哪些数据？

#### 1.7 如何理解分布式锁？

### 二、进程管理

- 进程与线程
- 进程状态的切换（生命周期）
- 进程调度算法
- 进程同步
- 经典同步问题
- 进程通信
- 线程间通信和进程间通信
- 进程操作
- 孤儿进程和僵尸进程
- 守护进程
- 上下文切换

#### 2.1 进程与线程

- 进程
- 线程
- 区别

##### 2.1.1 进程

**进程是资源分配的基本单位**，用来管理资源（例如：内在，文件，网络等资源）

进程控制块(Process Control Block, PCB)描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指对PCB的操作。**（PCB是描述进程的数据结构）**

下图显示了 4 个程序创建了 4 个进程，这 4 个进程可以并发地执行。

![](./img/os01.png)

##### 2.1.2 线程

**线程是独立调度的基本单位**，一个进程可以有多个线程，它们共享进程资源。

##### 2.1.3 区别

- **拥有资源**，进程得资源分配的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源。
- **调度**，线程是独立调试的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。
- **系统开销**，由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程CPU环境的保存及新高度进程CPU环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。
- **通信方面**，进程间通信(IPC)需要进程同步和互斥手段的辅助，以保证数据的一致性。而线程间可以通过直接读/写同一进程中的数据段(如全局变量)来进行通信。

#### 2.2 进程状态的切换（生命周期）

#### 2.3 进程调度算法

不同环境的调度算法目标不同，因此需要针对不同环境来讨论调度算法。

- 批处理系统
- 交互式系统
- 实时系统

##### 2.3.1 批处理系统

批处理系统没有太多的用户操作，在该系统中，调度算法目标是保证吞吐量和周转时间（从提交到终止的时间）。

- 先来先服务(FCFS)
- 短作业优先
- 最短剩余时间优先

**先来先服务(FCFS)**，按照请求的顺序进行高度。有利于长作业，但不利于短作业，因为短作业必须一直等待前面的长作业执行完毕才能执行，而长作业又需要执行很长时间，造成了短作业等待时间过长。

##### 2.3.2 交互式系统

交互式系统有大量的用户交互操作，在该系统中调度算法的目标是快速地进行响应。

- 时间片轮转
- 优先级调度
- 多级反馈队列

##### 2.3.3 实时系统

实时系统要求一个请求在一个确定时间内得到响应。

#### 2.4 进程同步

- 临界区
- 同步与互斥
- 信号量
- 管程

#### 2.5 经典同步问题

#### 2.6 进程通信

#### 2.7 线程间通信和进程间通信

- 线程间通信
- 进程间通信

##### 2.7.1 线程间通信

- **synchronized同步**
  - 这种方式，本质上就是“共享内存”
- **while轮询方式**
  - 在这种方式下，
  - 之所以说它浪费资源，
  - 就类似于现实生活中，
- **wait/notify机制**
  - 当条件未满足时，
- **管道通信**
  - java.io.

##### 2.7.2 进程间通信

- **管道(Pip)**：
- **命名管道(named pipe)**：
- **信号(Signal)**:
- **消息(Message)队列**：
- **共享内存**：
- **内存映射(mapped memory)**：
- **信号量(semaphore)**：
- **套接口(Socket)**：

#### 2.8 进程操作

Linux进程结构可由三部分组成：

- 代码段（程序）
- 数据段（数据）
- 堆栈段（控制块PCB）

#### 2.9 孤儿进程和僵尸进程

#### 2.10 守护进程

#### 2.11 上下文切换

### 三、死锁

### 四、内存管理

### 五、设备管理

### 六、链接


### 参考资料

- 《深入操作系统第四版》
- [操作系统](https://github.com/frank-lam/fullstack-tutorial/blob/master/notes/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.md)

## 联系作者

<div align="center">
    <p>
        平凡世界，贵在坚持。
    </p>
    <img src="./img/contact.png" />
</div>